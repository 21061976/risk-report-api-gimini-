<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RiskReportAI - מחולל דוחות ניהול סיכונים חכם</title>
    <style>
        /* --- General Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2c3e50;
        }
        html { scroll-behavior: smooth; }

        /* --- Generator View Styles --- */
        .generator-view {
            max-width: 800px;
            margin: 40px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            display: block;
        }
        .generator-view.hidden { display: none; }

        .generator-view h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .generator-view .subtitle {
            text-align: center;
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 40px;
        }
        .form-group {
            margin-bottom: 25px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: #34495e;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-group input:focus, .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
        }
        .generate-btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }
        .api-key-group {
            border-top: 1px solid #ddd;
            margin-top: 30px;
            padding-top: 20px;
        }
        
        /* --- Report View Styles --- */
        .report-view { display: none; }
        .report-view.visible { display: block; }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white; padding: 25px 40px; text-align: center;
            position: relative; overflow: hidden; margin-bottom: 0;
        }
        .header::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; }
        .header .subtitle { font-size: 1.2em; opacity: 0.9; margin-bottom: 5px; }
        .date-badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 6px 14px; border-radius: 20px; font-size: 0.85em; margin-top: 10px; }
        
        .control-buttons { position: fixed; top: 20px; left: 20px; z-index: 1000; display:flex; flex-direction:column; gap: 8px;}
        .control-btn { background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 0.9em; font-weight: bold; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4); transition: all 0.3s ease;}
        .control-btn:hover { transform: translateY(-2px); }
        .edit-toggle.active { background: #27ae60; }
        .pdf-export { background: #e74c3c; }
        
        .editable[contenteditable="true"] { background: rgba(52, 152, 219, 0.1); border: 2px dashed #3498db; outline: none; cursor: text; padding: 5px; }
        
        .success-message { position: fixed; top: 120px; left: 20px; background: #27ae60; color: white; padding: 15px 25px; border-radius: 10px; font-weight: bold; opacity: 0; transform: translateY(20px); transition: all 0.3s ease; z-index: 1001; }
        .success-message.show { opacity: 1; transform: translateY(0); }
        
        .nav-menu { position: sticky; top: 0; background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); z-index: 999; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .nav-links { display: flex; justify-content: center; align-items: center; padding: 0; list-style: none; margin: 0; }
        .nav-links li { flex: 1; }
        .nav-links a { display: block; padding: 18px 20px; color: #bdc3c7; text-decoration: none; text-align: center; font-weight: 600; font-size: 0.95em; transition: all 0.3s ease; }
        .nav-links a:hover, .nav-links a.active { background: #2c3e50; color: white; }
        
        .section { scroll-margin-top: 80px; }
        .section-header { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 20px 30px; font-size: 1.8em; font-weight: bold; text-align: center; margin: 0; }
        .project-overview { padding: 30px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); }
        .overview-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08); border-top: 4px solid #3498db; margin-bottom: 20px; }
        .overview-card h4 { color: #2c3e50; margin-bottom: 12px; font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        
        .risks-container { padding: 30px; background: white; }
        .risk-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .summary-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .summary-number { font-size: 3em; font-weight: bold; margin-bottom: 10px; }
        .very-high { color: #e74c3c; } .high { color: #f39c12; } .medium { color: #f1c40f; } .low { color: #27ae60; }
        
        .risks-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 25px; margin-top: 30px; }
        .risk-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); padding: 30px; border-top: 6px solid; }
        .risk-very-high { border-top-color: #e74c3c; } .risk-high { border-top-color: #f39c12; } .risk-medium { border-top-color: #f1c40f; } .risk-low { border-top-color: #27ae60; }
        .risk-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; gap: 15px; }
        .risk-title { font-size: 1.3em; font-weight: bold; color: #2c3e50; flex: 1; }
        .risk-severity { padding: 8px 15px; border-radius: 25px; font-size: 0.8em; font-weight: bold; color: white; white-space: nowrap; }
        .severity-very-high { background: #e74c3c; } .severity-high { background: #f39c12; } .severity-medium { background: #f1c40f; color: #2c3e50; } .severity-low { background: #27ae60; }
        .risk-metrics { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0; text-align: center; }
        .metric { background: #f8f9fa; padding: 15px; border-radius: 10px; }
        .metric-value { font-size: 1.8em; font-weight: bold; color: #2c3e50; }
        .metric-label { font-size: 0.9em; color: #7f8c8d; margin-top: 5px; }
        .risk-description, .risk-opportunity { color: #34495e; line-height: 1.7; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 15px; border-right: 4px solid #bdc3c7; }
        .risk-opportunity { border-right-color: #27ae60; }
        .impact-title, .opportunity-title { font-weight: bold; margin-bottom: 10px; }
        .impact-title { color: #e74c3c; } .opportunity-title { color: #27ae60; margin-top: 20px; }
        .impact-list, .opportunity-list { list-style: none; padding-right: 15px; }
        .impact-list li, .opportunity-list li { padding: 8px 0; border-bottom: 1px solid #ecf0f1; }
        
        .strategies-section { padding: 30px; background: #ecf0f1; }
        .strategy-card { background: white; margin: 20px 0; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden; }
        .strategy-header { background: #27ae60; color: white; padding: 20px; font-size: 1.2em; font-weight: bold; }
        .strategy-content { padding: 20px; }

        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 60px; height: 60px; border: 5px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { color: white; margin-top: 20px; font-size: 1.2em; }
    </style>
</head>
<body>
    
    <div class="loading-overlay" id="loading-overlay">
        <div>
            <div class="loading-spinner"></div>
            <div class="loading-text">מפיק דוח, נא להמתין...</div>
        </div>
    </div>

    <div class="generator-view" id="generator-view">
        <h1>מחולל דוחות ניהול סיכונים</h1>
        <p class="subtitle">הזן את פרטי הפרויקט כדי להפיק דוח מפורט ומותאם אישית באמצעות AI</p>

        <div class="form-group">
            <label for="project-name">שם הפרויקט</label>
            <input type="text" id="project-name" value="תפיסת חטיבת הנעורים">
        </div>

        <div class="form-group">
            <label for="project-description">תיאור הפרויקט (משפט אחד)</label>
            <input type="text" id="project-description" value="עיצוב מחדש של החינוך לגילאי 12-15 באופן הוליסטי">
        </div>
        
        <div class="form-group">
            <label for="project-goals">מטרות מרכזיות (הפרד בפסיק)</label>
            <textarea id="project-goals">פיתוח כשירויות רגשיות וחברתיות (SEL), חיזוק תחושת השייכות והמסוגלות, מתן מענה לשונות בין תלמידים</textarea>
        </div>

        <div class="form-group">
            <label for="project-stakeholders">בעלי עניין ושותפים</label>
            <input type="text" id="project-stakeholders" value="משרד החינוך, צוותי הוראה, הורים, תלמידים, רשויות מקומיות">
        </div>

        <div class="form-group api-key-group">
            <label for="api-key">מפתח API של Google Gemini</label>
            <input type="password" id="api-key" placeholder="הזן את מפתח ה-API שלך כאן">
        </div>

        <button class="generate-btn" id="generate-btn">🚀 הפק דוח חכם</button>
    </div>

    <div class="report-view" id="report-view">
        </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const generatorView = document.getElementById('generator-view');
        const reportView = document.getElementById('report-view');
        const generateBtn = document.getElementById('generate-btn');
        const loadingOverlay = document.getElementById('loading-overlay');

        generateBtn.addEventListener('click', handleReportGeneration);

        async function handleReportGeneration() {
            const inputs = {
                projectName: document.getElementById('project-name').value,
                projectDescription: document.getElementById('project-description').value,
                projectGoals: document.getElementById('project-goals').value,
                projectStakeholders: document.getElementById('project-stakeholders').value,
                apiKey: document.getElementById('api-key').value,
            };

            if (!inputs.projectName || !inputs.projectDescription || !inputs.projectGoals) {
                alert('אנא מלא את כל פרטי הפרויקט.');
                return;
            }
            if (!inputs.apiKey) {
                alert('אנא הזן מפתח API של Google Gemini.');
                return;
            }
            
            loadingOverlay.classList.add('active');

            try {
                // In a real application, you would replace this with a fetch call to the Gemini API
                const aiResponse = await simulateGeminiResponse();
                const parsedData = parseAIResponse(aiResponse);
                renderReport(parsedData, inputs);
                
                generatorView.classList.add('hidden');
                reportView.classList.add('visible');
            } catch (error) {
                console.error("Error generating report:", error);
                alert("אירעה שגיאה בהפקת הדוח. בדוק את המסוף (console) לפרטים.");
            } finally {
                loadingOverlay.classList.remove('active');
            }
        }
        
        async function simulateGeminiResponse() {
            console.log("Simulating a high-quality API call...");
            return new Promise(resolve => {
                setTimeout(() => {
                    const sampleResponse = `
[REPORT_ENTITY]: משרד החינוך • אגף על-יסודי • 2025
[PROJECT_OVERVIEW_PURPOSE]: המעבר מחינוך מבוסס-דעת לחינוך הוליסטי המשלב פיתוח כשירים רגשיים-חברתיים (SEL) חיוני להתמודדות עם אתגרי המאה ה-21. התפיסה שואפת להפוך את חטיבת הביניים למרחב צמיחה משמעותי, המטפח תלמידים בעלי חוסן נפשי, תחושת מסוגלות ויכולת למידה עצמאית.
[PROJECT_OVERVIEW_STAKEHOLDERS]: הצלחת המהלך תלויה בשיתוף פעולה הדוק בין כלל הגורמים במערכת: אגפי משרד החינוך (מו"פ, פדגוגיה, טכנולוגיה), הנהלות בתי הספר, צוותי ההוראה שידרשו לעבור הכשרה משמעותית, הורים שיצטרכו להכיר במודל החינוכי החדש, והתלמידים עצמם, שעומדים במרכז התהליך.

[RISK_CARD_START]
[RISK_TITLE]: התנגדות סמויה וגלויה של צוותי חינוך
[RISK_SEVERITY_LEVEL]: Very High
[RISK_PROBABILITY]: 9
[RISK_IMPACT]: 10
[RISK_DESCRIPTION]: המעבר לתפיסה הוליסטית דורש שינוי עמוק בתפיסת התפקיד של המורים, מצוות המקצוע למנטורים ומלווים אישיים. רבים מהמורים, שהוכשרו בשיטות מסורתיות, עלולים לחוש חוסר ביטחון, התנגדות לצורך בהתמקדות ב-SEL על חשבון תכני דעת, או לראות בכך תוספת עומס בלתי אפשרית.
[RISK_CONSEQUENCES]:
* יישום חלקי או "למראית עין" בלבד של התפיסה בשטח, תוך חזרה לדפוסי הוראה ישנים.
* שחיקה ועזיבה של מורים איכותיים שאינם מתחברים לשינוי.
* יצירת אנטגוניזם בין צוותים מובילים לצוותים מתנגדים בתוך בתי הספר.
[RISK_OPPORTUNITIES]:
* הזדמנות ליצירת דור חדש של מורים-מנטורים בעלי תפיסת תפקיד רחבה ומתגמלת.
* מיצוב מערכת החינוך הישראלית כמובילה עולמית בחינוך הוליסטי לגיל ההתבגרות.
* פיתוח מודלים חדשניים של הכשרה והתפתחות מקצועית למורים.
[RISK_CARD_END]

[RISK_CARD_START]
[RISK_TITLE]: פערים בתשתיות טכנולוגיות וכישורים דיגיטליים
[RISK_SEVERITY_LEVEL]: High
[RISK_PROBABILITY]: 8
[RISK_IMPACT]: 8
[RISK_DESCRIPTION]: התפיסה החדשה נשענת במידה רבה על שימוש בכלים דיגיטליים ללמידה מותאמת אישית, הערכה חלופית ותקשורת. בתי ספר רבים, בעיקר בפריפריה, סובלים ממחסור במחשבים, רשת אינטרנט לא יציבה וצוותי הוראה שאינם בקיאים דיים בשימוש פדגוגי בטכנולוגיה.
[RISK_CONSEQUENCES]:
* העמקת פערים לימודיים וחברתיים בין תלמידים ממרכז ופריפריה.
* חוסר יכולת ליישם רכיבים מרכזיים בתפיסה, כמו תיקי עבודות דיגיטליים או למידה היברידית.
[RISK_OPPORTUNITIES]:
* הזדמנות להאצת הטרנספורמציה הדיגיטלית במערכת החינוך.
* יצירת שותפויות אסטרטגיות עם חברות הייטק ופילנתרופיה לצמצום פערים.
* פיתוח מודלים של "פדגוגיה דיגיטלית" ייחודיים לישראל.
[RISK_CARD_END]

[RISK_CARD_START]
[RISK_TITLE]: קושי במדידה והערכה של הצלחה
[RISK_SEVERITY_LEVEL]: High
[RISK_PROBABILITY]: 7
[RISK_IMPACT]: 9
[RISK_DESCRIPTION]: בניגוד לציונים במבחנים, קשה למדוד באופן כמותי וסטנדרטי הצלחה בפיתוח "כשירויות רגשיות" או "תחושת מסוגלות". היעדר כלי מדידה מוסכמים עלול להוביל לביקורת ציבורית, קושי בהצדקת המשאבים, וחוסר יכולת ללמוד ולהשתפר.
[RISK_CONSEQUENCES]:
* תפיסת המהלך כ"כישלון" על ידי הציבור והתקשורת בשל היעדר נתונים "קשים".
* חזרה ללחץ על הישגים מדידים (ציוני בגרות) על חשבון המטרות ההוליסטיות.
* קושי בזיהוי בתי ספר או מורים הזקוקים לתמיכה וליווי.
[RISK_OPPORTUNITIES]:
* הובלה עולמית בפיתוח כלי הערכה חלופיים וחדשניים (מחוונים, תצפיות, הערכת עמיתים).
* יצירת שפה משותפת ומבוססת נתונים לדיון על חינוך איכותי.
[RISK_CARD_END]

[STRATEGY_START]
[STRATEGY_TITLE]: תוכנית הכשרה והטמעה רב-שכבתית (Multi-layered PD)
[STRATEGY_DESCRIPTION]: במקום הכשרה חד-פעמית, תיושם תוכנית התפתחות מקצועית מתמשכת הכוללת שלוש שכבות: 1. הכשרת ליבה ארצית על עקרונות התפיסה. 2. הקמת קהילות למידה מקצועיות (PLC) בית-ספריות ללמידת עמיתים. 3. מתן ליווי אישי (מנטורינג) למורים על ידי מדריכים פדגוגיים שהוכשרו לכך. המיקוד יהיה בבניית תחושת מסוגלות וביטחון של המורים להוביל את השינוי.
[STRATEGY_END]

[STRATEGY_START]
[STRATEGY_TITLE]: מודל "הטמעה באדוות" (Ripple Implementation)
[STRATEGY_DESCRIPTION]: התוכנית לא תוטמע בבת אחת בכל בתי הספר. בשנה הראשונה ייבחרו 15-20 "בתי ספר חלוצים" (Pioneer Schools) שיקבלו תמיכה ומשאבים מוגברים. בתי ספר אלו יהוו מודל, יפתחו חומרי למידה ויכשירו את מורי השלב הבא. הצלחתם תייצר מומנטום חיובי ותפחית התנגדויות בשלבים הבאים של ההתרחבות.
[STRATEGY_END]

[STRATEGY_START]
[STRATEGY_TITLE]: פיתוח "ארגז כלים להערכה מעצבת"
[STRATEGY_DESCRIPTION]: יוקם צוות מומחים לפיתוח מאגר דיגיטלי של כלי הערכה מגוונים, שאינם רק ציונים. המאגר יכלול מחוונים להערכת עבודות חקר, כלי משוב והערכת עמיתים, מודלים לתיקי עבודות (פורטפוליו), ושאלונים למדידת אקלים כיתה ותחושת שייכות. הכלים יהיו מודולריים ויאפשרו גמישות למורים לבחור את המתאים להם.
[STRATEGY_END]
`;
                    resolve(sampleResponse);
                }, 2500); // Simulate 2.5 second delay
            });
        }

        function parseAIResponse(responseText) {
            const data = { risks: [], strategies: {} };
            const extractValue = (key) => (responseText.match(new RegExp(`\\[${key}\\]: (.*?)(?=\\n\\[|$)`, 's')) || [])[1]?.trim() || '';
            
            data.entity = extractValue('REPORT_ENTITY');
            data.overview_purpose = extractValue('PROJECT_OVERVIEW_PURPOSE');
            data.overview_stakeholders = extractValue('PROJECT_OVERVIEW_STAKEHOLDERS');

            const riskBlocks = responseText.split('[RISK_CARD_START]').slice(1);
            data.risks = riskBlocks.map(block => ({
                title: (block.match(/\[RISK_TITLE\]: (.*?)\n/s) || [])[1]?.trim(),
                severityLevel: (block.match(/\[RISK_SEVERITY_LEVEL\]: (.*?)\n/s) || [])[1]?.trim(),
                probability: (block.match(/\[RISK_PROBABILITY\]: (.*?)\n/s) || [])[1]?.trim(),
                impact: (block.match(/\[RISK_IMPACT\]: (.*?)\n/s) || [])[1]?.trim(),
                description: (block.match(/\[RISK_DESCRIPTION\]: (.*?)(?=\n\[RISK_CONSEQUENCES\])/s) || [])[1]?.trim(),
                consequences: (block.match(/\[RISK_CONSEQUENCES\]: (.*?)(?=\n\[RISK_OPPORTUNITIES\])/s) || [])[1]?.trim().split('*').map(s => s.trim()).filter(Boolean),
                opportunities: (block.match(/\[RISK_OPPORTUNITIES\]: (.*?)(?=\n\[RISK_CARD_END\])/s) || [])[1]?.trim().split('*').map(s => s.trim()).filter(Boolean),
            }));

            const strategyBlocks = responseText.split('[STRATEGY_START]').slice(1);
            data.strategies = strategyBlocks.map(block => ({
                title: (block.match(/\[STRATEGY_TITLE\]: (.*?)\n/s) || [])[1]?.trim(),
                description: (block.match(/\[STRATEGY_DESCRIPTION\]: (.*?)(?=\n\[STRATEGY_END\])/s) || [])[1]?.trim(),
            }));
            return data;
        }

        function renderReport(data, inputs) {
            const reportContainer = document.getElementById('report-view');
            const severityMap = { "Very High": { class: "very-high", text: "חומרה גבוהה מאוד" }, "High": { class: "high", text: "חומרה גבוהה" }, "Medium": { class: "medium", text: "חומרה בינונית" }, "Low": { class: "low", text: "חומרה נמוכה" } };
            const riskSummary = data.risks.reduce((acc, risk) => { acc[risk.severityLevel] = (acc[risk.severityLevel] || 0) + 1; return acc; }, {});

            const riskCardsHTML = data.risks.map(risk => {
                const severity = severityMap[risk.severityLevel] || { class: "low", text: "לא ידוע" };
                const consequencesHTML = risk.consequences.map(item => `<li class="editable">${item}</li>`).join('');
                const opportunitiesHTML = risk.opportunities.map(item => `<li class="editable">${item}</li>`).join('');
                return `
                <div class="risk-card risk-${severity.class}">
                    <div class="risk-header"><div class="risk-title editable">${risk.title}</div><div class="risk-severity severity-${severity.class} editable">${severity.text}</div></div>
                    <div class="risk-metrics">
                        <div class="metric"><div class="metric-value editable">${risk.probability}</div><div class="metric-label editable">הסתברות</div></div>
                        <div class="metric"><div class="metric-value editable">${risk.impact}</div><div class="metric-label editable">עוצמת נזק</div></div>
                        <div class="metric"><div class="metric-value editable">${risk.probability * risk.impact}</div><div class="metric-label editable">דרגת חומרה</div></div>
                    </div>
                    <div class="risk-description editable">${risk.description}</div>
                    <div class="impact-title editable">השלכות אפשריות:</div><ul class="impact-list">${consequencesHTML}</ul>
                    <div class="opportunity-title editable">הזדמנויות:</div><ul class="opportunity-list">${opportunitiesHTML}</ul>
                </div>`;
            }).join('');

            const strategyCardsHTML = data.strategies.map(strategy => `
                <div class="strategy-card">
                    <div class="strategy-header editable">${strategy.title}</div>
                    <div class="strategy-content"><p class="editable">${strategy.description}</p></div>
                </div>`).join('');
            
            const finalHTML = `
            <div class="container">
                <div class="control-buttons">
                    <button class="control-btn" onclick="window.location.reload()">🔄 דוח חדש</button>
                    <button class="control-btn edit-toggle" id="edit-toggle-btn">🎨 התחל עריכה</button>
                    <button class="control-btn pdf-export" onclick="window.print()">📄 ייצוא ל-PDF</button>
                    <div class="success-message" id="successMessage"></div>
                </div>
                <header class="header"><h1 class="editable">${inputs.projectName}</h1><div class="subtitle editable">${inputs.projectDescription}</div><div class="date-badge editable">${data.entity}</div></header>
                <nav class="nav-menu">
                    <ul class="nav-links">
                        <li><a href="#overview">🎯 סקירת הפרויקט</a></li>
                        <li><a href="#risks">⚠️ ניהול סיכונים</a></li>
                        <li><a href="#strategies">📈 תוכנית התמודדות</a></li>
                    </ul>
                </nav>
                <section id="overview" class="section project-overview">
                    <div class="overview-card"><h4><span class="icon">🎯</span> מטרת העל</h4><p class="editable">${data.overview_purpose}</p></div>
                    <div class="overview-card"><h4><span class="icon">👥</span> בעלי עניין מרכזיים</h4><p class="editable">${data.overview_stakeholders}</p></div>
                </section>
                <section id="risks" class="section risks-container">
                    <div class="section-header editable">⚠️ ניהול סיכונים</div>
                    <div class="risk-summary">
                        <div class="summary-card"><div class="summary-number very-high editable">${riskSummary['Very High'] || 0}</div><div class="editable">חומרה גבוהה מאוד</div></div>
                        <div class="summary-card"><div class="summary-number high editable">${riskSummary['High'] || 0}</div><div class="editable">חומרה גבוהה</div></div>
                        <div class="summary-card"><div class="summary-number medium editable">${riskSummary['Medium'] || 0}</div><div class="editable">חומרה בינונית</div></div>
                        <div class="summary-card"><div class="summary-number low editable">${riskSummary['Low'] || 0}</div><div class="editable">חומרה נמוכה</div></div>
                    </div>
                    <div class="risks-grid">${riskCardsHTML}</div>
                </section>
                <section id="strategies" class="section strategies-section">
                    <div class="section-header editable">📈 תוכנית התמודדות עם סיכונים</div>
                    ${strategyCardsHTML}
                </section>
            </div>`;
            
            reportView.innerHTML = finalHTML;
            document.getElementById('edit-toggle-btn').addEventListener('click', (e) => toggleEdit(e.target));
        }
        
        function toggleEdit(button) {
            const reportContainer = document.getElementById('report-view');
            const isEditing = !button.classList.contains('active');
            const editableElements = reportContainer.querySelectorAll('.editable');
            const successMsg = reportContainer.querySelector('#successMessage');

            editableElements.forEach(el => el.contentEditable = isEditing);
            button.classList.toggle('active', isEditing);
            
            button.textContent = isEditing ? '💾 סיים עריכה' : '🎨 התחל עריכה';
            successMsg.textContent = isEditing ? '✅ מצב עריכה הופעל!' : '✅ השינויים נשמרו!';
            
            successMsg.classList.add('show');
            setTimeout(() => successMsg.classList.remove('show'), 3000);
        }
    });
    </script>
</body>
</html>
