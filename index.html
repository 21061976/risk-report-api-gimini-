<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RiskReportAI - ××—×•×œ×œ ×“×•×—×•×ª × ×™×”×•×œ ×¡×™×›×•× ×™× ×—×›×</title>
    <style>
        /* --- General Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2c3e50;
        }
        html { scroll-behavior: smooth; }

        /* --- Generator View Styles --- */
        .generator-view {
            max-width: 800px;
            margin: 40px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        .generator-view h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .generator-view .subtitle {
            text-align: center;
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 40px;
        }
        .form-group {
            margin-bottom: 25px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: #34495e;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-group input:focus, .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
        }
        .generate-btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }
        .api-key-group {
            border-top: 1px solid #ddd;
            margin-top: 30px;
            padding-top: 20px;
        }
        
        /* --- Report View Styles (Copied from user's sample) --- */
        .report-view { display: none; }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white; padding: 25px 40px; text-align: center;
            position: relative; overflow: hidden; margin-bottom: 0;
        }
        .header::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; position: relative; z-index: 1; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header .subtitle { font-size: 1.2em; opacity: 0.9; position: relative; z-index: 1; margin-bottom: 5px; }
        .date-badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 6px 14px; border-radius: 20px; font-size: 0.85em; margin-top: 10px; backdrop-filter: blur(10px); position: relative; z-index: 1; }
        
        .control-buttons { position: fixed; top: 20px; left: 20px; z-index: 1000; display:flex; flex-direction:column; gap: 8px;}
        .control-btn { background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 0.9em; font-weight: bold; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4); transition: all 0.3s ease;}
        .control-btn:hover { transform: translateY(-2px); }
        .edit-toggle.active { background: #27ae60; }
        .pdf-export { background: #e74c3c; }
        .html-export { background: #9b59b6; }

        .editable { padding: 3px; border-radius: 3px; transition: all 0.3s ease; }
        .editable[contenteditable="true"] { background: rgba(52, 152, 219, 0.1); border: 2px dashed #3498db; outline: none; cursor: text; padding: 5px; }
        
        .success-message { position: fixed; top: 150px; left: 20px; background: #27ae60; color: white; padding: 15px 25px; border-radius: 10px; font-weight: bold; opacity: 0; transform: translateY(20px); transition: all 0.3s ease; z-index: 1001; }
        .success-message.show { opacity: 1; transform: translateY(0); }
        
        .nav-menu { position: sticky; top: 0; background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); z-index: 999; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .nav-links { display: flex; justify-content: center; align-items: center; padding: 0; list-style: none; margin: 0; }
        .nav-links li { flex: 1; }
        .nav-links a { display: block; padding: 18px 20px; color: #bdc3c7; text-decoration: none; text-align: center; font-weight: 600; font-size: 0.95em; transition: all 0.3s ease; border-left: 1px solid #2c3e50; position: relative; }
        .nav-links a:hover, .nav-links a.active { background: #2c3e50; color: white; }
        .section { scroll-margin-top: 80px; }
        .section-header { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 20px 30px; font-size: 1.8em; font-weight: bold; text-align: center; margin: 0; position: relative; }
        .project-overview { padding: 30px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); }
        .overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-top: 30px; }
        .overview-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08); border-top: 4px solid #3498db; }
        .overview-card h4 { color: #2c3e50; margin-bottom: 12px; font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        .goals-section { background: white; margin: 20px 30px; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); }
        .goals-section h3 { color: #2c3e50; margin-bottom: 20px; font-size: 1.5em; text-align: center; }
        .goal-item, .deliverable-item { background: #f8f9fa; margin: 15px 0; padding: 20px; border-radius: 10px; border-right: 4px solid #27ae60; }
        .risks-container { padding: 30px; background: white; }
        .risk-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .summary-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .summary-number { font-size: 3em; font-weight: bold; margin-bottom: 10px; }
        .very-high { color: #e74c3c; } .high { color: #f39c12; } .medium { color: #f1c40f; } .low { color: #27ae60; }
        .risks-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-top: 30px; }
        .risk-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); padding: 30px; border-top: 6px solid; }
        .risk-very-high { border-top-color: #e74c3c; } .risk-high { border-top-color: #f39c12; } .risk-medium { border-top-color: #f1c40f; } .risk-low { border-top-color: #27ae60; }
        .risk-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; gap: 15px; }
        .risk-title { font-size: 1.3em; font-weight: bold; color: #2c3e50; flex: 1; }
        .risk-severity { padding: 8px 15px; border-radius: 25px; font-size: 0.8em; font-weight: bold; color: white; white-space: nowrap; }
        .severity-very-high { background: #e74c3c; } .severity-high { background: #f39c12; } .severity-medium { background: #f1c40f; color: #2c3e50; } .severity-low { background: #27ae60; }
        .risk-metrics { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0; text-align: center; }
        .metric { background: #f8f9fa; padding: 15px; border-radius: 10px; }
        .metric-value { font-size: 1.8em; font-weight: bold; color: #2c3e50; }
        .metric-label { font-size: 0.9em; color: #7f8c8d; margin-top: 5px; }
        .risk-description, .risk-opportunity { color: #34495e; line-height: 1.7; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 15px; border-right: 4px solid #bdc3c7; }
        .risk-opportunity { border-right-color: #27ae60; }
        .impact-title, .opportunity-title { font-weight: bold; margin-bottom: 10px; }
        .impact-title { color: #e74c3c; } .opportunity-title { color: #27ae60; margin-top: 20px; }
        .impact-list, .opportunity-list { list-style: none; padding-right: 15px; }
        .impact-list li, .opportunity-list li { padding: 8px 0; border-bottom: 1px solid #ecf0f1; position: relative; }
        .impact-list li::before { content: 'âš ï¸'; margin-left: 10px; }
        .opportunity-list li::before { content: 'âœ…'; margin-left: 10px; }
        
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 60px; height: 60px; border: 5px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { color: white; margin-top: 20px; font-size: 1.2em; }
    </style>
</head>
<body>
    
    <div class="loading-overlay" id="loading-overlay">
        <div>
            <div class="loading-spinner"></div>
            <div class="loading-text">××¤×™×§ ×“×•×—, × × ×œ×”××ª×™×Ÿ...</div>
        </div>
    </div>

    <div class="generator-view" id="generator-view">
        <h1>××—×•×œ×œ ×“×•×—×•×ª × ×™×”×•×œ ×¡×™×›×•× ×™×</h1>
        <p class="subtitle">×”×–×Ÿ ××ª ×¤×¨×˜×™ ×”×¤×¨×•×™×§×˜ ×›×“×™ ×œ×”×¤×™×§ ×“×•×— ××¤×•×¨×˜ ×•××•×ª×× ××™×©×™×ª ×‘×××¦×¢×•×ª AI</p>

        <div class="form-group">
            <label for="project-name">×©× ×”×¤×¨×•×™×§×˜</label>
            <input type="text" id="project-name" value="×ª×¤×™×¡×ª ×—×˜×™×‘×ª ×”× ×¢×•×¨×™×">
        </div>

        <div class="form-group">
            <label for="project-description">×ª×™××•×¨ ×”×¤×¨×•×™×§×˜ (××©×¤×˜ ××—×“)</label>
            <input type="text" id="project-description" value="×¢×™×¦×•×‘ ××—×“×© ×©×œ ×”×—×™× ×•×š ×œ×’×™×œ××™ 12-15">
        </div>
        
        <div class="form-group">
            <label for="project-goals">××˜×¨×•×ª ××¨×›×–×™×•×ª (×”×¤×¨×“ ×‘×¤×¡×™×§)</label>
            <textarea id="project-goals">×”×ª××•×“×“×•×ª ×¢× ××ª×’×¨×™ ×’×™×œ ×”×”×ª×‘×’×¨×•×ª, ×¤×™×ª×•×— ×›×©×™×¨×•×™×•×ª ×œ×—×™×™×, ×’×™×‘×•×© ×–×”×•×ª ×•×ª×›×œ×™×ª ××™×©×™×ª</textarea>
        </div>

        <div class="form-group">
            <label for="project-stakeholders">×‘×¢×œ×™ ×¢× ×™×™×Ÿ ×•×©×•×ª×¤×™×</label>
            <input type="text" id="project-stakeholders" value="××©×¨×“ ×”×—×™× ×•×š - ××’×£ ×¢×œ-×™×¡×•×“×™, ××’×£ ××•''×¤, ×”××–×›×™×¨×•×ª ×”×¤×“×’×•×’×™×ª, ××™× ×”×œ ×—×“×©× ×•×ª ×•×˜×›× ×•×œ×•×’×™×”">
        </div>

        <div class="form-group api-key-group">
            <label for="api-key">××¤×ª×— API ×©×œ Google Gemini</label>
            <input type="password" id="api-key" placeholder="×”×–×Ÿ ××ª ××¤×ª×— ×”-API ×©×œ×š ×›××Ÿ">
        </div>

        <button class="generate-btn" id="generate-btn">ğŸš€ ×”×¤×§ ×“×•×— ×—×›×</button>
    </div>

    <div class="report-view" id="report-view">
        <div class="container" id="report-container">
            </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const generatorView = document.getElementById('generator-view');
        const reportView = document.getElementById('report-view');
        const generateBtn = document.getElementById('generate-btn');
        const loadingOverlay = document.getElementById('loading-overlay');
        const reportContainer = document.getElementById('report-container');

        // --- Event Listener ---
        generateBtn.addEventListener('click', handleReportGeneration);

        // --- Main Function ---
        async function handleReportGeneration() {
            // 1. Gather Inputs
            const inputs = {
                projectName: document.getElementById('project-name').value,
                projectDescription: document.getElementById('project-description').value,
                projectGoals: document.getElementById('project-goals').value,
                projectStakeholders: document.getElementById('project-stakeholders').value,
                apiKey: document.getElementById('api-key').value,
            };

            if (!inputs.apiKey) {
                alert('×× × ×”×–×Ÿ ××¤×ª×— API ×©×œ Google Gemini.');
                return;
            }
            
            // 2. Show Loading State
            loadingOverlay.classList.add('active');

            // 3. Construct Prompt (This is where the magic happens)
            const megaPrompt = constructMegaPrompt(inputs);

            try {
                // 4. (SIMULATED) API Call 
                const aiResponse = await simulateGeminiResponse(megaPrompt);

                // 5. Parse the AI response
                const parsedData = parseAIResponse(aiResponse);
                
                // 6. Render the report
                renderReport(parsedData);

                // 7. Switch views
                generatorView.style.display = 'none';
                reportView.style.display = 'block';

            } catch (error) {
                console.error("Error generating report:", error);
                alert("××™×¨×¢×” ×©×’×™××” ×‘×”×¤×§×ª ×”×“×•×—. ×‘×“×•×§ ××ª ×”××¡×•×£ (console) ×œ×¤×¨×˜×™×.");
            } finally {
                // Hide loading state
                loadingOverlay.classList.remove('active');
            }
        }
        
        function constructMegaPrompt(data) {
            // This function creates the detailed prompt based on user input and your methodology
            // For the simulation, it's less critical, but in a real app, this would be very detailed.
            return `
                Project Name: ${data.projectName}
                Description: ${data.projectDescription}
                Goals: ${data.projectGoals}
                Stakeholders: ${data.projectStakeholders}
                ---
                Please generate a comprehensive risk management report based on the project details above.
                Format the response clearly using the following structure. Do NOT add any extra text before or after.
                
                [REPORT_TITLE]: The project name
                [REPORT_SUBTITLE]: The project description
                [REPORT_ENTITY]: The main stakeholder
                
                [RISK_CARD_START]
                [RISK_TITLE]: Title of the first risk
                [RISK_SEVERITY_LEVEL]: (Very High|High|Medium|Low)
                [RISK_PROBABILITY]: (1-10)
                [RISK_IMPACT]: (1-10)
                [RISK_DESCRIPTION]: Detailed description of the risk.
                [RISK_CONSEQUENCES]: Bulleted list of consequences, each on a new line starting with *
                [RISK_OPPORTUNITIES]: Bulleted list of opportunities, each on a new line starting with *
                [RISK_CARD_END]
                
                (Repeat RISK_CARD structure for 3-5 risks)
                
                [STRATEGY_START]
                [STRATEGY_TITLE]: Title of the strategy
                [STRATEGY_DESCRIPTION]: Description of the strategy
                [STRATEGY_END]
                
                (Repeat STRATEGY structure for 3 strategies)
            `;
        }

        async function simulateGeminiResponse(prompt) {
            console.log("Simulating API call with prompt:", prompt);
            // This function mimics a real API call with a delay.
            // The response is a pre-written string formatted exactly as we requested in the prompt.
            return new Promise(resolve => {
                setTimeout(() => {
                    const sampleResponse = `
                        [REPORT_TITLE]: ×ª×¤×™×¡×ª ×—×˜×™×‘×ª ×”× ×¢×•×¨×™×
                        [REPORT_SUBTITLE]: ×¢×™×¦×•×‘ ××—×“×© ×©×œ ×”×—×™× ×•×š ×œ×’×™×œ××™ 12-15
                        [REPORT_ENTITY]: ××©×¨×“ ×”×—×™× ×•×š â€¢ 2025

                        [RISK_CARD_START]
                        [RISK_TITLE]: ×”×ª× ×’×“×•×ª ×¦×•×•×ª×™× ×—×™× ×•×›×™×™× ×œ×©×™× ×•×™
                        [RISK_SEVERITY_LEVEL]: Very High
                        [RISK_PROBABILITY]: 9
                        [RISK_IMPACT]: 10
                        [RISK_DESCRIPTION]: ×”××¢×‘×¨ ×œ×ª×¤×™×¡×” ×”×•×œ×™×¡×˜×™×ª ×“×•×¨×© ×©×™× ×•×™ ×¢××•×§ ×‘×ª×¤×™×¡×ª ×”×ª×¤×§×™×“ ×©×œ ×”××•×¨×™×. ×¨×‘×™× ×¢×œ×•×œ×™× ×œ×”×ª× ×’×“ ×œ×¦×•×¨×š ×‘×”×ª××§×“×•×ª ×‘-SEL ×•×œ×™×•×•×™ ××™×©×™ ×¢×œ ×—×©×‘×•×Ÿ ×ª×›× ×™ ×“×¢×ª ××¡×•×¨×ª×™×™×.
                        [RISK_CONSEQUENCES]: 
                        * ×™×™×©×•× ×—×œ×§×™ ××• ×¡×œ×§×˜×™×‘×™ ×©×œ ×”×ª×¤×™×¡×” ×‘×©×˜×—
                        * ×”××©×š ×“×¤×•×¡×™ ×”×•×¨××” ××¡×•×¨×ª×™×™× ×©××™× × ×¢×•× ×™× ×¢×œ ×¦×¨×›×™ ×”×’×™×œ
                        * ×¤×’×™×¢×” ×‘××•×˜×™×‘×¦×™×” ×©×œ ×ª×œ××™×“×™× ×•×¢×œ×™×™×” ×‘× ×©×™×¨×” ×¡××•×™×”
                        [RISK_OPPORTUNITIES]: 
                        * ×™×¦×™×¨×ª ×“×•×¨ ×—×“×© ×©×œ ××•×¨×™×-×× ×˜×•×¨×™× ×¢× ×ª×¤×™×¡×ª ×ª×¤×§×™×“ ×¨×—×‘×”
                        * ×¤×™×ª×•×— ××•××—×™×•×ª ×™×™×—×•×“×™×ª ×©×œ ×™×©×¨××œ ×‘×—×™× ×•×š ×œ×’×™×œ ×”×”×ª×‘×’×¨×•×ª
                        * ×—×™×–×•×§ ××¢××“ ×”××•×¨×” ×›××œ×•×•×” ××©××¢×•×ª×™ ×‘×ª×”×œ×™×›×™ ×”×ª×¤×ª×—×•×ª
                        [RISK_CARD_END]

                        [RISK_CARD_START]
                        [RISK_TITLE]: ×¤×¢×¨×™× ×˜×›× ×•×œ×•×’×™×™× ×•×“×™×’×™×˜×œ×™×™×
                        [RISK_SEVERITY_LEVEL]: High
                        [RISK_PROBABILITY]: 8
                        [RISK_IMPACT]: 8
                        [RISK_DESCRIPTION]: ×¤×™×ª×•×— ×›×©×™×¨×•×™×•×ª ×“×™×’×™×˜×œ×™×•×ª ××ª×§×“××•×ª ×“×•×¨×© ×ª×©×ª×™×•×ª ×˜×›× ×•×œ×•×’×™×•×ª ×¢×“×›× ×™×•×ª. ×—×œ×§ ××‘×ª×™ ×”×¡×¤×¨ ×¡×•×‘×œ×™× ××¤×¢×¨×™× ××©××¢×•×ª×™×™× ×‘×ª×©×ª×™×•×ª ×•×‘×›×™×©×•×¨×™ ×”×¦×•×•×ª×™×.
                        [RISK_CONSEQUENCES]:
                        * ×”×¢××§×ª ×¤×¢×¨×™× ×‘×™×Ÿ ×‘×ª×™ ×¡×¤×¨ ×¢× ××©××‘×™× ×œ×›××œ×” ×œ×œ×
                        * ××™ ××™××•×© ×”×¤×•×˜× ×¦×™××œ ×©×œ ×“×•×¨ ×”××œ×¤× ×›×™×œ×™×“×™× ×“×™×’×™×˜×œ×™×™×
                        [RISK_OPPORTUNITIES]:
                        * ×™×¦×™×¨×ª ×©×•×ª×¤×•×™×•×ª ×¢× ×—×‘×¨×•×ª ×˜×›× ×•×œ×•×’×™×” ×•×ª×•×¨××™×
                        * ×¤×™×ª×•×— ×¤×ª×¨×•× ×•×ª ×—×“×©× ×™×™× ×‘×¢×œ×•×ª × ××•×›×” (BYOD, ×¢× ×Ÿ)
                        [RISK_CARD_END]
                        
                        [STRATEGY_START]
                        [STRATEGY_TITLE]: ×”×›×©×¨×” ×•×”×˜××¢×” ××“×•×¨×’×ª
                        [STRATEGY_DESCRIPTION]: ×¤×™×ª×•×— ×ª×•×›× ×™×ª ×”×›×©×¨×” ××§×™×¤×” ×œ×¦×•×•×ª×™× ×—×™× ×•×›×™×™×, ×”×›×•×œ×œ×ª ×¡×“× ××•×ª ×—×•×•×™×™×ª×™×•×ª, ×œ×™×•×•×™ ××™×©×™ ×•×§×”×™×œ×•×ª ×œ××™×“×”. ×”×”×˜××¢×” ×ª×ª×‘×¦×¢ ×‘×’×œ×™×, ×”×—×œ ××‘×ª×™ ×¡×¤×¨ ××•×‘×™×œ×™× ×©×™×©××©×• ×›××•×“×œ ×œ××—×¨×™×.
                        [STRATEGY_END]

                        [STRATEGY_START]
                        [STRATEGY_TITLE]: ××¢×¨×›×ª ×”×¢×¨×›×” ×”×•×œ×™×¡×˜×™×ª
                        [STRATEGY_DESCRIPTION]: ×¤×™×ª×•×— ×›×œ×™ ×”×¢×¨×›×” ×—×“×©× ×™×™× ×”××©×œ×‘×™× ×”×¢×¨×›×” ×¢×¦××™×ª, ×”×¢×¨×›×ª ×¢××™×ª×™×, ×ª×™×§×™ ×¢×‘×•×“×•×ª ×“×™×’×™×˜×œ×™×™× ×•××¢×§×‘ ××—×¨ ×”×ª×¤×ª×—×•×ª ××™×©×™×ª ×œ××•×¨×š ×–××Ÿ.
                        [STRATEGY_END]
                    `;
                    resolve(sampleResponse);
                }, 2500); // Simulate 2.5 second delay
            });
        }

        function parseAIResponse(responseText) {
            const data = {
                risks: [],
                strategies: [],
            };

            function extractValue(key) {
                const regex = new RegExp(`\\[${key}\\]: (.*?)(?=\\n\\[|$)`, 's');
                const match = responseText.match(regex);
                return match ? match[1].trim() : '';
            }

            data.title = extractValue('REPORT_TITLE');
            data.subtitle = extractValue('REPORT_SUBTITLE');
            data.entity = extractValue('REPORT_ENTITY');

            // Parse risks
            const riskBlocks = responseText.split('[RISK_CARD_START]').slice(1);
            riskBlocks.forEach(block => {
                const risk = {};
                risk.title = block.match(/\[RISK_TITLE\]: (.*?)\n/s)[1].trim();
                risk.severityLevel = block.match(/\[RISK_SEVERITY_LEVEL\]: (.*?)\n/s)[1].trim();
                risk.probability = block.match(/\[RISK_PROBABILITY\]: (.*?)\n/s)[1].trim();
                risk.impact = block.match(/\[RISK_IMPACT\]: (.*?)\n/s)[1].trim();
                risk.description = block.match(/\[RISK_DESCRIPTION\]: (.*?)(?=\n\[RISK_CONSEQUENCES\])/s)[1].trim();
                risk.consequences = block.match(/\[RISK_CONSEQUENCES\]: (.*?)(?=\n\[RISK_OPPORTUNITIES\])/s)[1].trim().split('*').map(s => s.trim()).filter(Boolean);
                risk.opportunities = block.match(/\[RISK_OPPORTUNITIES\]: (.*?)(?=\n\[RISK_CARD_END\])/s)[1].trim().split('*').map(s => s.trim()).filter(Boolean);
                data.risks.push(risk);
            });

            // Parse strategies
            const strategyBlocks = responseText.split('[STRATEGY_START]').slice(1);
            strategyBlocks.forEach(block => {
                const strategy = {};
                strategy.title = block.match(/\[STRATEGY_TITLE\]: (.*?)\n/s)[1].trim();
                strategy.description = block.match(/\[STRATEGY_DESCRIPTION\]: (.*?)(?=\n\[STRATEGY_END\])/s)[1].trim();
                data.strategies.push(strategy);
            });

            return data;
        }

        function renderReport(data) {
            // This function takes the parsed data and builds the HTML for the report
            
            const severityMap = {
                "Very High": { class: "very-high", text: "×—×•××¨×” ×’×‘×•×”×” ×××•×“" },
                "High": { class: "high", text: "×—×•××¨×” ×’×‘×•×”×”" },
                "Medium": { class: "medium", text: "×—×•××¨×” ×‘×™× ×•× ×™×ª" },
                "Low": { class: "low", text: "×—×•××¨×” × ××•×›×”" },
            };

            const riskSummary = data.risks.reduce((acc, risk) => {
                const level = risk.severityLevel;
                if (!acc[level]) acc[level] = 0;
                acc[level]++;
                return acc;
            }, {});

            const riskCardsHTML = data.risks.map(risk => {
                const severity = severityMap[risk.severityLevel] || { class: "low", text: "×œ× ×™×“×•×¢" };
                const consequencesHTML = risk.consequences.map(item => `<li class="editable">${item}</li>`).join('');
                const opportunitiesHTML = risk.opportunities.map(item => `<li class="editable">${item}</li>`).join('');

                return `
                <div class="risk-card risk-${severity.class}">
                    <div class="risk-header">
                        <div class="risk-title editable">${risk.title}</div>
                        <div class="risk-severity severity-${severity.class} editable">${severity.text}</div>
                    </div>
                    <div class="risk-metrics">
                        <div class="metric"><div class="metric-value editable">${risk.probability}</div><div class="metric-label editable">×”×¡×ª×‘×¨×•×ª</div></div>
                        <div class="metric"><div class="metric-value editable">${risk.impact}</div><div class="metric-label editable">×¢×•×¦××ª × ×–×§</div></div>
                        <div class="metric"><div class="metric-value editable">${risk.probability * risk.impact}</div><div class="metric-label editable">×“×¨×’×ª ×—×•××¨×”</div></div>
                    </div>
                    <div class="risk-description editable">${risk.description}</div>
                    <div class="risk-impact">
                        <div class="impact-title editable">×”×©×œ×›×•×ª ××¤×©×¨×™×•×ª:</div>
                        <ul class="impact-list">${consequencesHTML}</ul>
                    </div>
                    <div>
                        <div class="opportunity-title editable">×”×–×“×× ×•×™×•×ª:</div>
                        <ul class="opportunity-list">${opportunitiesHTML}</ul>
                    </div>
                </div>`;
            }).join('');

            const strategyCardsHTML = data.strategies.map(strategy => `
                <div class="strategy-card">
                    <div class="strategy-header editable">${strategy.title}</div>
                    <div class="strategy-content">
                        <p class="editable">${strategy.description}</p>
                    </div>
                </div>
            `).join('');

            const finalHTML = `
                <div class="control-buttons">
                    <button class="control-btn edit-toggle" onclick="toggleEdit(this)">ğŸ¨ ×”×ª×—×œ ×¢×¨×™×›×”</button>
                    <button class="control-btn pdf-export" onclick="window.print()">ğŸ“„ ×™×™×¦×•× ×œ-PDF</button>
                    <button class="control-btn html-export" onclick="alert('×œ×©××™×¨×”: ×œ×—×¥ Ctrl+S ×•×‘×—×¨ Web Page, Complete')">ğŸ’¾ ×©××•×¨ ×›-HTML</button>
                    <div class="success-message" id="successMessage"></div>
                </div>

                <header class="header">
                    <h1 class="editable">${data.title}</h1>
                    <div class="subtitle editable">${data.subtitle}</div>
                    <div class="date-badge editable">${data.entity}</div>
                </header>

                <nav class="nav-menu">
                    <ul class="nav-links">
                        <li><a href="#risks" class="nav-link">âš ï¸ × ×™×”×•×œ ×¡×™×›×•× ×™×</a></li>
                        <li><a href="#strategies" class="nav-link">ğŸ“ˆ ×ª×•×›× ×™×ª ×”×ª××•×“×“×•×ª</a></li>
                    </ul>
                </nav>

                <section id="risks" class="section">
                    <div class="section-header editable">âš ï¸ × ×™×”×•×œ ×¡×™×›×•× ×™×</div>
                    <div class="risks-container">
                        <div class="risk-summary">
                            <div class="summary-card"><div class="summary-number very-high editable">${riskSummary['Very High'] || 0}</div><div class="editable">×—×•××¨×” ×’×‘×•×”×” ×××•×“</div></div>
                            <div class="summary-card"><div class="summary-number high editable">${riskSummary['High'] || 0}</div><div class="editable">×—×•××¨×” ×’×‘×•×”×”</div></div>
                            <div class="summary-card"><div class="summary-number medium editable">${riskSummary['Medium'] || 0}</div><div class="editable">×—×•××¨×” ×‘×™× ×•× ×™×ª</div></div>
                            <div class="summary-card"><div class="summary-number low editable">${riskSummary['Low'] || 0}</div><div class="editable">×—×•××¨×” × ××•×›×”</div></div>
                        </div>
                        <div class="risks-grid">${riskCardsHTML}</div>
                    </div>
                </section>

                <section id="strategies" class="section">
                    <div class="section-header editable">ğŸ“ˆ ×ª×•×›× ×™×ª ×”×ª××•×“×“×•×ª ×¢× ×¡×™×›×•× ×™×</div>
                    <div class="strategies-section">${strategyCardsHTML}</div>
                </section>
            `;
            
            reportContainer.innerHTML = finalHTML;
            setupReportInteractivity();
        }
        
        // --- Interactivity for the final report ---
        function setupReportInteractivity() {
            // This function would contain logic for the final report,
            // like the scroll-spy for the nav menu if needed.
        }

        window.toggleEdit = function(button) {
            const isEditing = !button.classList.contains('active');
            const editableElements = reportContainer.querySelectorAll('.editable');
            const successMsg = document.getElementById('successMessage');

            editableElements.forEach(el => {
                el.contentEditable = isEditing;
            });

            button.classList.toggle('active', isEditing);
            if (isEditing) {
                button.textContent = 'ğŸ’¾ ×¡×™×™× ×¢×¨×™×›×”';
                successMsg.textContent = 'âœ… ××¦×‘ ×¢×¨×™×›×” ×”×•×¤×¢×œ!';
            } else {
                button.textContent = 'ğŸ¨ ×”×ª×—×œ ×¢×¨×™×›×”';
                successMsg.textContent = 'âœ… ×”×©×™× ×•×™×™× × ×©××¨×•!';
            }

            successMsg.classList.add('show');
            setTimeout(() => successMsg.classList.remove('show'), 3000);
        }

    });
    </script>
</body>
</html>
